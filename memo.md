# 抱团项目开发备忘录

## 2024-08-04 开发记录

### 前端依赖问题修复
- **问题**: `Uncaught TypeError: StyleSheet.create is not a function`
- **原因**: ajv模块版本不兼容
- **解决**: 安装正确版本的ajv模块 (`ajv@^8.0.0`)
- **命令**: `npm install ajv@^8.0.0 --save-dev --legacy-peer-deps`

### 前端服务启动
- **状态**: ✅ 前端服务正常运行在 http://localhost:3000
- **状态**: ✅ 后端服务正常运行在 http://localhost:8080

### 登录功能实现
- **功能**: 用户注册登录，支持手机号密码、验证码登录
- **接口**: 调用真实后端接口 `http://localhost:8080/auth/login`
- **状态**: ✅ 登录功能正常工作

### 注册功能实现
- **功能**: 用户注册，支持手机号注册
- **接口**: 调用真实后端接口 `http://localhost:8080/auth/register`
- **状态**: ✅ 注册功能正常工作

### 验证码功能实现
- **功能**: 发送验证码
- **接口**: 调用真实后端接口 `http://localhost:8080/auth/sendVerifyCode`
- **状态**: ✅ 验证码功能正常工作

### 登录流程优化
- **流程**: 登录成功 → 类别选择页面 → 聊天页面
- **实现**: 
  - 登录成功后跳转到类别选择页面
  - 类别选择页面显示所有可用类别
  - 选择类别后进入对应的聊天页面
- **状态**: ✅ 完整流程正常工作

### 类别页面重新设计 (2024-08-04 更新)
- **问题**: 用户反馈类别选择页面设计过于复杂，不符合扁平化风格
- **改进**:
  - 简化页面布局，减少不必要的装饰元素
  - 调整字体大小和间距，使页面更简洁
  - 优化数据获取逻辑，支持从服务端获取真实数据
  - 如果服务端数据获取失败，自动使用默认模拟数据
  - 移除复杂的统计信息显示，只保留类别名称和描述
- **设计原则**: 严格遵循扁平化设计，简洁大方
- **状态**: ✅ 重新设计完成

### 聊天页面重新设计 (2024-08-04 更新)
- **问题**: 用户反馈聊天页面需要左右布局，左边分组列表，右边聊天窗口
- **改进**:
  - 采用左右布局设计，左侧280px宽度显示分组列表
  - 右侧显示聊天窗口，包含消息列表和输入框
  - 分组列表支持选择切换，当前选中分组高亮显示
  - 聊天窗口显示当前分组名称和成员数
  - 消息气泡采用扁平化设计，区分自己和他人消息
  - 输入框支持多行输入，发送按钮状态联动
- **设计特点**:
  - 扁平化设计风格，简洁大气
  - 合理的布局比例，适合Web页面
  - 清晰的信息层次，易于使用
  - 响应式交互，用户体验良好
- **状态**: ✅ 重新设计完成

### ChatScreen参数传递错误修复 (2024-08-04 更新)
- **问题**: `TypeError: Cannot read properties of undefined (reading 'params')`
- **原因**: SimpleNavigator中ChatScreen的参数传递方式不正确
- **修复**: 将`category`属性改为`route={{params: {category: currentCategory}}}`传递
- **状态**: ✅ 错误修复完成

### ChatScreen renderMessage函数调用错误修复 (2024-08-04 更新)
- **问题**: `TypeError: Cannot read properties of undefined (reading 'userId')`
- **原因**: `messages.map(renderMessage)`直接调用renderMessage函数，但函数期望接收`{item}`对象
- **修复**: 改为`messages.map((item, index) => renderMessage({item}))`正确传递参数
- **状态**: ✅ 错误修复完成

### 页面布局优化 (2024-08-04 更新)
- **类别选择页面优化**:
  - 改为居中显示，不占全屏
  - 设置固定宽度480px，最大宽度90%
  - 添加白色卡片背景和轻微阴影
  - 限制类别列表最大高度400px
  - 优化间距和布局，更加简洁
- **聊天页面高度修复**:
  - 设置容器高度为`100vh`确保占满屏幕
  - 主内容区域高度为`calc(100vh - 64px)`
  - 聊天区域使用flex布局确保正确分布
  - 确保消息列表和输入框正确显示
- **状态**: ✅ 布局优化完成

### 后端接口开发
- **类别接口**: `GET /category/list` - 获取所有启用的类别
- **用户接口**: `POST /auth/login` - 用户登录
- **注册接口**: `POST /auth/register` - 用户注册
- **验证码接口**: `POST /auth/sendVerifyCode` - 发送验证码
- **状态**: ✅ 所有接口正常工作

### 数据库设计
- **用户表**: 存储用户基本信息
- **类别表**: 存储平台类别信息
- **分组表**: 存储聊天分组信息
- **聊天消息表**: 存储聊天记录
- **工具表**: 存储平台工具信息
- **状态**: ✅ 数据库结构完整

### 技术栈
- **前端**: React Native Web
- **后端**: Spring Boot 3.4.5
- **数据库**: MySQL 8.0
- **ORM**: MyBatis
- **认证**: JWT
- **状态管理**: Redux Toolkit

### 当前功能状态
- ✅ 用户注册登录
- ✅ 验证码发送
- ✅ 类别选择页面 (重新设计完成)
- ✅ 聊天页面左右布局 (重新设计完成)
- ✅ 扁平化UI设计
- ✅ 前后端接口对接
- ✅ 参数传递错误修复

### 待开发功能
- 聊天功能 (WebSocket)
- 工具管理
- 分组管理
- 后台管理系统 