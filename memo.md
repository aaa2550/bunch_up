# 抱团项目开发备忘录

## 2024-08-04 开发记录

### 前端依赖问题修复
- **问题**: `Uncaught TypeError: StyleSheet.create is not a function`
- **原因**: ajv模块版本不兼容
- **解决**: 安装正确版本的ajv模块 (`ajv@^8.0.0`)
- **命令**: `npm install ajv@^8.0.0 --save-dev --legacy-peer-deps`

### 前端服务启动
- **状态**: ✅ 前端服务正常运行在 http://localhost:3000
- **状态**: ✅ 后端服务正常运行在 http://localhost:8080

### 登录功能实现
- **功能**: 用户注册登录，支持手机号密码、验证码登录
- **接口**: 调用真实后端接口 `http://localhost:8080/auth/login`
- **状态**: ✅ 登录功能正常工作

### 注册功能实现
- **功能**: 用户注册，支持手机号注册
- **接口**: 调用真实后端接口 `http://localhost:8080/auth/register`
- **状态**: ✅ 注册功能正常工作

### 验证码功能实现
- **功能**: 发送验证码
- **接口**: 调用真实后端接口 `http://localhost:8080/auth/sendVerifyCode`
- **状态**: ✅ 验证码功能正常工作

### 登录流程优化
- **流程**: 登录成功 → 类别选择页面 → 聊天页面
- **实现**: 
  - 登录成功后跳转到类别选择页面
  - 类别选择页面显示所有可用类别
  - 选择类别后进入对应的聊天页面
- **状态**: ✅ 完整流程正常工作

### 类别页面重新设计 (2024-08-04 更新)
- **问题**: 用户反馈类别选择页面设计过于复杂，不符合扁平化风格
- **改进**:
  - 简化页面布局，减少不必要的装饰元素
  - 调整字体大小和间距，使页面更简洁
  - 优化数据获取逻辑，支持从服务端获取真实数据
  - 如果服务端数据获取失败，自动使用默认模拟数据
  - 移除复杂的统计信息显示，只保留类别名称和描述
- **设计原则**: 严格遵循扁平化设计，简洁大方
- **状态**: ✅ 重新设计完成

### 聊天页面重新设计 (2024-08-04 更新)
- **问题**: 用户反馈聊天页面需要左右布局，左边分组列表，右边聊天窗口
- **改进**:
  - 采用左右布局设计，左侧280px宽度显示分组列表
  - 右侧显示聊天窗口，包含消息列表和输入框
  - 分组列表支持选择切换，当前选中分组高亮显示
  - 聊天窗口显示当前分组名称和成员数
  - 消息气泡采用扁平化设计，区分自己和他人消息
  - 输入框支持多行输入，发送按钮状态联动
- **设计特点**:
  - 扁平化设计风格，简洁大气
  - 合理的布局比例，适合Web页面
  - 清晰的信息层次，易于使用
  - 响应式交互，用户体验良好
- **状态**: ✅ 重新设计完成

### ChatScreen参数传递错误修复 (2024-08-04 更新)
- **问题**: `TypeError: Cannot read properties of undefined (reading 'params')`
- **原因**: SimpleNavigator中ChatScreen的参数传递方式不正确
- **修复**: 将`category`属性改为`route={{params: {category: currentCategory}}}`传递
- **状态**: ✅ 错误修复完成

### ChatScreen renderMessage函数调用错误修复 (2024-08-04 更新)
- **问题**: `TypeError: Cannot read properties of undefined (reading 'userId')`
- **原因**: `messages.map(renderMessage)`直接调用renderMessage函数，但函数期望接收`{item}`对象
- **修复**: 改为`messages.map((item, index) => renderMessage({item}))`正确传递参数
- **状态**: ✅ 错误修复完成

### 页面布局优化 (2024-08-04 更新)
- **类别选择页面优化**:
  - 改为居中显示，不占全屏
  - 设置固定宽度480px，最大宽度90%
  - 添加白色卡片背景和轻微阴影
  - 限制类别列表最大高度400px
  - 优化间距和布局，更加简洁
- **聊天页面高度修复**:
  - 设置容器高度为`100vh`确保占满屏幕
  - 主内容区域高度为`calc(100vh - 64px)`
  - 聊天区域使用flex布局确保正确分布
  - 确保消息列表和输入框正确显示
- **状态**: ✅ 布局优化完成

### 弹窗组件和聊天页面重新设计 (2024-08-04 更新)
- **扁平化弹窗组件**:
  - 创建了完整的Modal组件，支持多种类型（success、warning、error、info）
  - 支持不同尺寸（small、medium、large）
  - 包含类型图标、关闭按钮、确认取消按钮
  - 扁平化设计风格，圆角16px，阴影效果
  - 支持点击遮罩关闭，滚动内容区域
- **聊天页面布局重新设计**:
  - 保留左侧分组列表（280px宽度）
  - 中间为聊天区域，包含消息列表和输入框
  - 右侧添加程序坞样式的菜单（60px宽度）
  - 程序坞包含工具、设置、我的、消息、搜索等功能入口
  - 扁平化设计，层次感强
- **状态**: ✅ 重新设计完成

### Toast提示组件和聊天页面优化 (2024-08-04 更新)
- **扁平化Toast组件**:
  - 创建了Toast组件，支持多种类型（success、error、warning、info）
  - 自动显示和隐藏，无需用户点击确认
  - 动画效果：淡入淡出和滑动
  - 扁平化设计风格，圆角8px，阴影效果
  - 支持自定义显示时长
- **登录页面优化**:
  - 使用Toast组件替代alert弹窗
  - 登录成功后显示成功提示，1.5秒后自动跳转
  - 错误提示更加友好
  - 扁平化设计风格统一
- **聊天页面布局优化**:
  - 程序坞移到最左边（60px宽度）
  - 分组列表移到中间（280px宽度）
  - 聊天区域移到最右边（自适应宽度）
  - 移除底部空白，充分利用空间
  - 三栏布局更加合理
- **状态**: ✅ 优化完成

### 后端接口开发
- **类别接口**: `GET /category/list` - 获取所有启用的类别
- **用户接口**: `POST /auth/login` - 用户登录
- **注册接口**: `POST /auth/register` - 用户注册
- **验证码接口**: `POST /auth/sendVerifyCode` - 发送验证码
- **状态**: ✅ 所有接口正常工作

### 数据库设计
- **用户表**: 存储用户基本信息
- **类别表**: 存储平台类别信息
- **分组表**: 存储聊天分组信息
- **聊天消息表**: 存储聊天记录
- **工具表**: 存储平台工具信息
- **状态**: ✅ 数据库结构完整

### 技术栈
- **前端**: React Native Web
- **后端**: Spring Boot 3.4.5
- **数据库**: MySQL 8.0
- **ORM**: MyBatis
- **认证**: JWT
- **状态管理**: Redux Toolkit

### 当前功能状态
- ✅ 用户注册登录
- ✅ 验证码发送
- ✅ 类别选择页面 (重新设计完成)
- ✅ 聊天页面左右布局 (重新设计完成)
- ✅ 扁平化UI设计
- ✅ 前后端接口对接
- ✅ 参数传递错误修复

### 待开发功能
- 聊天功能 (WebSocket)
- 工具管理
- 分组管理
- 后台管理系统 

### 聊天窗口底部空白修复 (2024-08-04 更新)
- **问题**: 聊天窗口底部存在大片空白，浪费空间
- **解决方案**:
  - 为容器添加 `maxHeight: '100vh'` 和 `overflow: 'hidden'`
  - 为聊天区域添加 `maxHeight: 'calc(100vh - 32px)'`
  - 为输入框容器设置 `minHeight: 60px`
  - 为输入框和发送按钮设置 `minHeight: 36px`
  - 确保聊天区域充分利用可用空间
- **效果**: 移除底部空白，聊天区域完全填充屏幕
- **状态**: ✅ 修复完成 

### 聊天界面优化修复 (2024-08-04 更新)
- **消息时间显示优化**:
  - 改为每5分钟显示一次时间，而不是每条消息都显示
  - 时间显示在消息中间，使用灰色背景圆角样式
  - 添加时间格式化函数，显示为 HH:MM 格式
  - 优化时间显示逻辑，减少视觉干扰
- **输入框和发送按钮对齐修复**:
  - 统一输入框和发送按钮的高度为40px
  - 统一圆角为20px，更加圆润
  - 调整内边距，确保视觉平衡
  - 添加 `textAlignVertical: 'center'` 和 `lineHeight: 20` 确保文字垂直居中
  - 使用 `alignItems: 'center'` 确保输入框和按钮水平对齐
- **效果**: 聊天界面更加简洁，输入区域视觉统一
- **状态**: ✅ 修复完成 